<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{fragments/layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>Team Management - SprintPilot</title>
</head>
<body>
    <main>
        <!-- Toast Container -->
        <div id="toastContainer" class="fixed top-4 right-4 z-50 flex flex-col gap-3 pointer-events-none">
            <!-- Toasts will be dynamically inserted here -->
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div id="deleteConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Delete Team Member</h3>
                        <p class="text-sm text-gray-600 mt-1">This action cannot be undone</p>
                    </div>
                </div>
                <p class="text-gray-700 mb-6">
                    Are you sure you want to delete <strong id="deleteMemberName"></strong>? This will permanently remove them from the team.
                </p>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeDeleteConfirm()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 hover:bg-gray-300 text-gray-800 focus:ring-gray-400">
                        Cancel
                    </button>
                    <button onclick="confirmDelete()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-red-600 hover:bg-red-700 text-white focus:ring-red-500">
                        Delete Member
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Unassign Confirmation Modal -->
        <div id="unassignConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Unassign from Sprint</h3>
                        <p class="text-sm text-gray-600 mt-1">Remove member from current sprint</p>
                    </div>
                </div>
                <p class="text-gray-700 mb-6">
                    Are you sure you want to unassign <strong id="unassignMemberName"></strong> from the current sprint? They will no longer be part of this sprint's team.
                </p>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeUnassignConfirm()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 hover:bg-gray-300 text-gray-800 focus:ring-gray-400">
                        Cancel
                    </button>
                    <button onclick="confirmUnassign()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-amber-600 hover:bg-amber-700 text-white focus:ring-amber-500">
                        Unassign Member
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Assign Confirmation Modal -->
        <div id="assignConfirmModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-md">
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-shrink-0 w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-900">Assign to Sprint</h3>
                        <p class="text-sm text-gray-600 mt-1">Add member to current sprint</p>
                    </div>
                </div>
                <p class="text-gray-700 mb-6">
                    Are you sure you want to assign <strong id="assignMemberName"></strong> to the current sprint? They will become part of this sprint's team.
                </p>
                <div class="flex justify-end space-x-3">
                    <button onclick="closeAssignConfirm()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 hover:bg-gray-300 text-gray-800 focus:ring-gray-400">
                        Cancel
                    </button>
                    <button onclick="confirmAssign()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 bg-green-600 hover:bg-green-700 text-white focus:ring-green-500">
                        Assign Member
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Exact React Card Component -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200/80 p-6">
            <!-- Modal Overlay (hidden by default) -->
            <div id="memberModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4">
                <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg">
                    <h3 class="text-2xl font-bold mb-6 text-gray-800" id="modalTitle">Add Member</h3>
                    <form id="memberForm" class="space-y-5">
                        <!-- Name Field -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="memberName" name="name" class="block w-full border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500" required />
                        </div>
                        
                        <!-- Email Field -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="memberEmail" name="email" class="block w-full border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500" required />
                        </div>
                        
                        <!-- Location Field -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                            <select id="memberLocation" name="location" class="block w-full border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500">
                                <option value="">-</option>
                                <option value="Bangalore">Bangalore</option>
                                <option value="Coimbatore">Coimbatore</option>
                                <option value="Indonesia">Indonesia</option>
                            </select>
                        </div>
                        
                        <!-- Role Field -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                            <select id="memberRole" name="role" class="block w-full border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500">
                                <option value="FRONTEND">Frontend</option>
                                <option value="BACKEND" selected>Backend</option>
                                <option value="QA">QA</option>
                                <option value="DEVOPS">DevOps</option>
                                <option value="DESIGNER">Designer</option>
                                <option value="MANAGER">Manager</option>
                            </select>
                        </div>
                        
                        <!-- Daily Capacity Field -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Daily Capacity (hrs/day)</label>
                            <input type="number" id="memberCapacity" name="capacity" min="1" max="12" value="6" class="block w-full border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500" />
                        </div>
                        
                        <!-- Notice when member is not in sprint -->
                        <div id="notInSprintNotice" class="hidden bg-amber-50 border border-amber-200 rounded-lg p-4">
                            <div class="flex items-start gap-3">
                                <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                        <div>
                                    <h4 class="text-sm font-semibold text-amber-800 mb-1">Leave Days Not Available</h4>
                                    <p class="text-sm text-amber-700">This member is not assigned to the current sprint. Please assign the member to a sprint to manage leave days.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Leave Days Field (Only for Edit) -->
                        <div id="leaveDaysSection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Leave Days</label>
                            <div class="space-y-3">
                                <div class="flex flex-col sm:flex-row items-stretch sm:items-end gap-2">
                                    <div class="flex-1">
                                        <label class="block text-xs text-gray-600 mb-1">From Date <span class="text-gray-400">(required)</span></label>
                                        <input type="date" id="leaveStartDate" 
                                               class="block w-full border border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500 bg-white" />
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-xs text-gray-600 mb-1">To Date <span class="text-gray-400">(optional)</span></label>
                                        <input type="date" id="leaveEndDate" 
                                               class="block w-full border border-gray-300 rounded-lg shadow-sm p-2.5 text-sm focus:ring-primary-500 focus:border-primary-500 bg-white" 
                                               placeholder="Same as From Date" />
                                    </div>
                                    <div class="flex gap-2">
                                        <button type="button" onclick="addLeaveDateRange()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500 whitespace-nowrap">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                            </svg>
                                    Add
                                </button>
                                        <button type="button" onclick="clearLeaveDateInputs()" class="px-4 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-700 focus:ring-gray-400" title="Clear dates">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 italic">
                                    ðŸ’¡ Tip: Leave "To Date" empty for single day, or select a range for multiple days. Weekends (Sat/Sun) are automatically excluded.
                                </p>
                            </div>
                            <div id="leaveDaysContainer" class="mt-4 flex flex-wrap gap-2">
                                <!-- Leave days will be added here dynamically -->
                            </div>
                        </div>
                    </form>
                    <div class="mt-8 flex justify-end space-x-3">
                        <button onclick="closeModal()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-gray-200 hover:bg-gray-300 text-gray-800 focus:ring-gray-400">
                            Cancel
                        </button>
                        <button onclick="saveMember()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500">
                            Save
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Header Section - Exact React Match -->
            <div class="flex flex-col md:flex-row justify-between md:items-start mb-6 gap-4">
                <div class="flex-1">
                <h2 class="text-3xl font-bold text-gray-800">Team Configuration</h2>
                    <div class="mt-3 inline-flex items-center gap-2 bg-primary-50 border border-primary-200 rounded-lg px-3 py-2">
                        <svg class="w-4 h-4 text-primary-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-sm font-medium text-primary-800">Members with a blue highlight are assigned to the current sprint</span>
                    </div>
                </div>
                <!-- Add Member Button -->
                <button onclick="openAddModal()" class="px-5 py-2.5 rounded-lg font-semibold text-sm transition-all duration-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center space-x-2 bg-primary-600 hover:bg-primary-700 text-white focus:ring-primary-500">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Add Member</span>
                </button>
            </div>
            
            <!-- Team Table - Exact React Implementation -->
            <div class="overflow-x-auto overflow-y-visible">
                <table class="min-w-full bg-white text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600 uppercase tracking-wider">Role</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600 uppercase tracking-wider">Capacity (hrs/day)</th>
                            <th class="text-left py-3 px-2 font-semibold text-gray-600 uppercase tracking-wider w-56">Leave Days</th>
                            <th class="text-left py-3 px-4 font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="teamTableBody" class="divide-y divide-gray-200">
                        <!-- Team members will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <script>
            let currentMemberId = null;
            let leaveDays = [];
            let teamMembers = [];
            let currentSprintId = null;
            let showOnlyCurrentSprint = false;
            let memberToDelete = null;
            let selectedMemberIds = [];
            let availableSprints = [];
            let currentSprintDates = { startDate: null, endDate: null };
            
            // API Base URL
            const API_BASE_URL = '/api/team-members';
            const SPRINT_API_BASE_URL = '/api/sprints';
            
            // Get sprintId from cookie
            function getSprintIdFromCookie() {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'currentSprintId') {
                        return value;
                    }
                }
                return null;
            }
            
            // Load team members on page load
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize currentSprintId from cookie
                currentSprintId = getSprintIdFromCookie();
                console.log('Sprint ID from cookie:', currentSprintId);
                
                loadCurrentSprintAndMembers();
                
                // Close modal when clicking outside
                document.getElementById('memberModal').addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            });
            
            // No initialization needed for native date inputs
            
            // Fetch current sprint and then load team members
            async function loadCurrentSprintAndMembers() {
                // Refresh sprintId from cookie in case it changed
                currentSprintId = getSprintIdFromCookie();
                
                if (currentSprintId) {
                    console.log('Current sprint ID:', currentSprintId);
                    
                    // Fetch sprint details to get dates for calendar restrictions
                    try {
                        const response = await fetch(`${SPRINT_API_BASE_URL}/${currentSprintId}`);
                        const data = await response.json();
                        
                        if (data.success && data.data) {
                            // Store sprint dates for calendar restrictions
                            currentSprintDates.startDate = data.data.startDate;
                            currentSprintDates.endDate = data.data.endDate;
                            console.log('Sprint dates set for calendar:', currentSprintDates);
                            
                            // Apply date restrictions to the date pickers
                            updateDatePickerRestrictions();
                        }
                    } catch (error) {
                        console.error('Error loading current sprint details:', error);
                    }
                } else {
                    console.log('No active sprint found in cookie');
                }
                
                // Load team members (with or without sprint context)
                await loadTeamMembers();
            }
            
            // Update date picker restrictions based on sprint dates
            function updateDatePickerRestrictions() {
                const leaveStartDateInput = document.getElementById('leaveStartDate');
                const leaveEndDateInput = document.getElementById('leaveEndDate');
                
                if (currentSprintDates.startDate && currentSprintDates.endDate) {
                    // Set min and max attributes to restrict date selection
                    leaveStartDateInput.setAttribute('min', currentSprintDates.startDate);
                    leaveStartDateInput.setAttribute('max', currentSprintDates.endDate);
                    leaveEndDateInput.setAttribute('min', currentSprintDates.startDate);
                    leaveEndDateInput.setAttribute('max', currentSprintDates.endDate);
                    
                    console.log(`ðŸ“… Date pickers restricted to sprint range: ${currentSprintDates.startDate} to ${currentSprintDates.endDate}`);
                } else {
                    // Remove restrictions if no sprint dates available
                    leaveStartDateInput.removeAttribute('min');
                    leaveStartDateInput.removeAttribute('max');
                    leaveEndDateInput.removeAttribute('min');
                    leaveEndDateInput.removeAttribute('max');
                    console.log('ðŸ“… Date pickers have no restrictions (no active sprint)');
                }
            }
            
            // Fetch and display team members
            async function loadTeamMembers() {
                try {
                    // Build URL with optional sprint parameter
                    let url = `${API_BASE_URL}?active=true`;
                    if (currentSprintId) {
                        url += `&currentSprint=${currentSprintId}`;
                    }
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        teamMembers = data.data;
                        renderTeamTable();
                    } else {
                        console.error('Failed to load team members:', data.message);
                        showError('Failed to load team members');
                    }
                } catch (error) {
                    console.error('Error loading team members:', error);
                    showError('Error loading team members. Please refresh the page.');
                }
            }
            
            // Render team members table
            function renderTeamTable() {
                const tbody = document.getElementById('teamTableBody');
                
                let filteredMembers = teamMembers;
                
                // Sort members: assigned to current sprint first, then unassigned
                if (currentSprintId) {
                    filteredMembers = filteredMembers.sort((a, b) => {
                        // If both assigned or both unassigned, maintain original order
                        if (a.assignedToCurrentSprint === b.assignedToCurrentSprint) {
                            return 0;
                        }
                        // Assigned members come first
                        return a.assignedToCurrentSprint ? -1 : 1;
                    });
                }
                
                if (filteredMembers.length === 0) {
                    const message = 'No team members found. Click "Add Member" to create one.';
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="py-8 px-4 text-center text-gray-500">
                                ${message}
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = filteredMembers.map(member => {
                    const roleColors = {
                        'FRONTEND': 'bg-blue-100 text-blue-800',
                        'BACKEND': 'bg-green-100 text-green-800',
                        'QA': 'bg-yellow-100 text-yellow-800',
                        'DEVOPS': 'bg-purple-100 text-purple-800',
                        'DESIGNER': 'bg-pink-100 text-pink-800',
                        'MANAGER': 'bg-gray-100 text-gray-800'
                    };
                    
                    const roleColor = roleColors[member.role] || 'bg-gray-100 text-gray-800';
                    const leaveDaysCount = member.leaveDays ? member.leaveDays.length : 0;
                    const leaveTooltipContent = leaveDaysCount > 0
                        ? `<div class="font-semibold text-xs mb-2 pb-1.5 border-b border-gray-600 flex items-center gap-1.5">
                            <svg class="w-3 h-3 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                            <span>Leave Dates</span>
                        </div>
                        <div class="space-y-0.5">
                            ${member.leaveDays.map(d => `
                                <div class="flex items-center gap-1.5 py-0.5">
                                    <svg class="w-2.5 h-2.5 text-primary-400 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                    <span class="text-xs">${escapeHtml(d)}</span>
                                </div>
                            `).join('')}
                        </div>`
                        : '';
                    
                    // Highlight row if member is in current sprint
                    // Debug logging
                    console.log('Member:', member.name, 'assignedToCurrentSprint:', member.assignedToCurrentSprint, 'currentSprintId:', currentSprintId);
                    
                    const rowHighlight = currentSprintId && member.assignedToCurrentSprint
                        ? 'bg-primary-50 border-l-4 border-primary-500'
                        : '';
                    
                    console.log('Member:', member.name, 'rowHighlight:', rowHighlight);
                    
                    return `
                        <tr class="${rowHighlight}">
                            <td class="py-3 px-4">
                                <div class="flex items-center gap-2">
                                    <div>
                                        <div class="font-medium text-gray-900">${escapeHtml(member.name)}</div>
                                        ${member.location ? `<div class="text-xs text-gray-500 mt-0.5">${escapeHtml(member.location)}</div>` : ''}
                                    </div>
                                </div>
                            </td>
                            <td class="py-3 px-4 text-gray-600">${escapeHtml(member.email || '-')}</td>
                            <td class="py-3 px-4 text-gray-600">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${roleColor}">
                                    ${member.role}
                                </span>
                            </td>
                            <td class="py-3 px-4 text-gray-600">${member.dailyCapacity}</td>
                            <td class="py-3 px-2 text-gray-600">
                                ${leaveDaysCount > 0 ? `
                                    <div class="relative flex items-center gap-2">
                                        <span>${leaveDaysCount}</span>
                                        <div class="group relative">
                                            <button type="button"
                                                    class="p-1.5 rounded-full border border-gray-200 text-gray-500 hover:text-primary-600 hover:border-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-400 transition-colors">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                          d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                        </svg>
                                    </button>
                                            <div class="pointer-events-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200 absolute left-full ml-2 top-0 bg-gray-800 text-white rounded-lg px-3 py-2 shadow-2xl z-[9999] w-36 max-h-[300px] overflow-y-auto" style="scrollbar-width: thin; scrollbar-color: #4B5563 #1F2937;">
                                                ${leaveTooltipContent}
                                            </div>
                                        </div>
                                </div>
                                ` : `<span>${leaveDaysCount}</span>`}
                            </td>
                            <td class="py-3 px-4">
                                <div class="flex space-x-3">
                                    <button type="button" onclick="editMember('${member.id}')" class="text-primary-600 hover:text-primary-800 transition-colors" title="Edit Member">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                        </svg>
                                    </button>
                                    ${currentSprintId ? (member.assignedToCurrentSprint ? `
                                    <button type="button" onclick="openUnassignConfirm('${member.id}', '${escapeHtml(member.name)}')" class="text-amber-600 hover:text-amber-800 transition-colors" title="Unassign from Current Sprint">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6"></path>
                                        </svg>
                                    </button>
                                    ` : `
                                    <button type="button" onclick="openAssignConfirm('${member.id}', '${escapeHtml(member.name)}')" class="text-green-600 hover:text-green-800 transition-colors" title="Assign to Current Sprint">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                                        </svg>
                                    </button>
                                    `) : ''}
                                    <button type="button" onclick="deleteMember('${member.id}')" class="text-danger hover:text-red-700 transition-colors" title="Delete Member">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Modal Functions
            function openAddModal() {
                currentMemberId = null;
                leaveDays = [];
                document.getElementById('modalTitle').textContent = 'Add Member';
                document.getElementById('memberName').value = '';
                document.getElementById('memberEmail').value = '';
                document.getElementById('memberLocation').value = 'Bangalore';
                document.getElementById('memberRole').value = 'BACKEND';
                document.getElementById('memberCapacity').value = '6';
                document.getElementById('leaveStartDate').value = '';
                document.getElementById('leaveEndDate').value = '';
                updateLeaveDaysDisplay();
                // Hide leave days section and notice for new members
                document.getElementById('leaveDaysSection').classList.add('hidden');
                document.getElementById('notInSprintNotice').classList.add('hidden');
                // Make name, email, and location editable for new members
                document.getElementById('memberName').removeAttribute('readonly');
                document.getElementById('memberEmail').removeAttribute('readonly');
                document.getElementById('memberLocation').removeAttribute('disabled');
                document.getElementById('memberName').classList.remove('bg-gray-100', 'cursor-not-allowed');
                document.getElementById('memberEmail').classList.remove('bg-gray-100', 'cursor-not-allowed');
                document.getElementById('memberLocation').classList.remove('bg-gray-100', 'cursor-not-allowed');
                document.getElementById('memberModal').classList.remove('hidden');
            }
            
            function closeModal() {
                document.getElementById('memberModal').classList.add('hidden');
            }
            
            async function editMember(memberId) {
                try {
                    const response = await fetch(`${API_BASE_URL}/${memberId}`);
                    const data = await response.json();
                    
                    if (data.success && data.data) {
                        const member = data.data;
                        currentMemberId = member.id;
                        
                        document.getElementById('modalTitle').textContent = 'Edit Member';
                document.getElementById('memberName').value = member.name;
                        document.getElementById('memberEmail').value = member.email || '';
                        document.getElementById('memberLocation').value = member.location || '';
                document.getElementById('memberRole').value = member.role;
                        document.getElementById('memberCapacity').value = member.dailyCapacity;
                        leaveDays = member.leaveDays || [];
                updateLeaveDaysDisplay();
                        // Show leave days section only if member is in current sprint
                        if (member.assignedToCurrentSprint) {
                            document.getElementById('leaveDaysSection').classList.remove('hidden');
                            document.getElementById('notInSprintNotice').classList.add('hidden');
                        } else {
                            document.getElementById('leaveDaysSection').classList.add('hidden');
                            document.getElementById('notInSprintNotice').classList.remove('hidden');
                        }
                        
                        // Clear date input fields (they should start empty for adding new ranges)
                        document.getElementById('leaveStartDate').value = '';
                        document.getElementById('leaveEndDate').value = '';
                        
                        // Apply date restrictions based on sprint dates
                        updateDatePickerRestrictions();
                        
                        // Make name, email, and location read-only for editing
                        document.getElementById('memberName').setAttribute('readonly', 'readonly');
                        document.getElementById('memberEmail').setAttribute('readonly', 'readonly');
                        document.getElementById('memberLocation').setAttribute('disabled', 'disabled');
                        document.getElementById('memberName').classList.add('bg-gray-100', 'cursor-not-allowed');
                        document.getElementById('memberEmail').classList.add('bg-gray-100', 'cursor-not-allowed');
                        document.getElementById('memberLocation').classList.add('bg-gray-100', 'cursor-not-allowed');
                
                document.getElementById('memberModal').classList.remove('hidden');
                    } else {
                        showError('Failed to load member details');
                    }
                } catch (error) {
                    console.error('Error loading member:', error);
                    showError('Error loading member details');
                }
            }
            
            function deleteMember(memberId) {
                // Find member name to show in confirmation
                const member = teamMembers.find(m => m.id === memberId);
                const memberName = member ? member.name : 'this team member';
                
                // Store member info and show confirmation modal
                memberToDelete = memberId;
                document.getElementById('deleteMemberName').textContent = memberName;
                document.getElementById('deleteConfirmModal').classList.remove('hidden');
            }
            
            function closeDeleteConfirm() {
                memberToDelete = null;
                document.getElementById('deleteConfirmModal').classList.add('hidden');
            }
            
            async function confirmDelete() {
                if (!memberToDelete) return;
                
                const memberId = memberToDelete;
                closeDeleteConfirm();
                
                try {
                    const response = await fetch(`${API_BASE_URL}/${memberId}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('Team member deleted successfully');
                        await loadCurrentSprintAndMembers();
                    } else {
                        showError(data.message || 'Failed to delete team member');
                    }
                } catch (error) {
                    console.error('Error deleting member:', error);
                    showError('Error deleting team member');
                }
            }
            
            function addLeaveDateRange() {
                const startDateInput = document.getElementById('leaveStartDate');
                const endDateInput = document.getElementById('leaveEndDate');
                const startDateStr = startDateInput.value;
                let endDateStr = endDateInput.value;
                
                if (!startDateStr) {
                    showError('Please select a From Date');
                    return;
                }
                
                // If no end date, use start date (single day)
                if (!endDateStr) {
                    endDateStr = startDateStr;
                }
                
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                
                if (endDate < startDate) {
                    showError('To Date must be after or equal to From Date');
                    return;
                }
                
                // Generate all dates in the range (excluding weekends)
                // Parse dates properly to avoid timezone issues
                const currentDate = new Date(startDateStr + 'T00:00:00');
                const finalDate = new Date(endDateStr + 'T00:00:00');
                let addedCount = 0;
                let skippedWeekends = 0;
                
                while (currentDate <= finalDate) {
                    const dayOfWeek = currentDate.getDay();
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const day = String(currentDate.getDate()).padStart(2, '0');
                    const dateStr = `${year}-${month}-${day}`;
                    
                    // Skip Saturdays (6) and Sundays (0)
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        skippedWeekends++;
                        console.log(`Skipping weekend: ${dateStr} (day ${dayOfWeek})`);
                    } else if (!leaveDays.includes(dateStr)) {
                        leaveDays.push(dateStr);
                        addedCount++;
                        console.log(`Adding weekday: ${dateStr} (day ${dayOfWeek})`);
                    }
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (addedCount > 0) {
                    leaveDays.sort();
                    updateLeaveDaysDisplay();
                    
                    let message;
                    if (addedCount === 1) {
                        message = `Added 1 leave day (${startDateStr})`;
                    } else {
                        message = `Added ${addedCount} leave day${addedCount > 1 ? 's' : ''} (${startDateStr} to ${endDateStr})`;
                        if (skippedWeekends > 0) {
                            message += ` â€¢ Skipped ${skippedWeekends} weekend day${skippedWeekends > 1 ? 's' : ''}`;
                        }
                    }
                    showSuccess(message);
                    
                    // Don't clear inputs - allow adding multiple ranges
                } else if (skippedWeekends > 0 && addedCount === 0) {
                    showWarning('Selected range contains only weekends (Saturdays/Sundays are automatically excluded)');
                } else {
                    showWarning('All dates in this range are already added');
                }
            }
            
            function clearLeaveDateInputs() {
                document.getElementById('leaveStartDate').value = '';
                document.getElementById('leaveEndDate').value = '';
            }
            
            function removeLeaveDay(date) {
                leaveDays = leaveDays.filter(d => d !== date);
                updateLeaveDaysDisplay();
            }
            
            function updateLeaveDaysDisplay() {
                const container = document.getElementById('leaveDaysContainer');
                container.innerHTML = leaveDays.map(date => `
                    <span class="bg-primary-100 text-primary-800 text-xs font-medium px-2.5 py-1 rounded-full flex items-center">
                        ${date}
                        <button type="button" onclick="removeLeaveDay('${date}')" class="ml-2 text-red-500 hover:text-red-700 font-bold">
                            &times;
                        </button>
                    </span>
                `).join('');
            }
            
            async function saveMember() {
                const name = document.getElementById('memberName').value;
                const email = document.getElementById('memberEmail').value;
                const location = document.getElementById('memberLocation').value;
                const role = document.getElementById('memberRole').value;
                const capacity = document.getElementById('memberCapacity').value;
                
                if (!name.trim()) {
                    showError('Please enter a name');
                    return;
                }
                
                if (!email.trim()) {
                    showError('Please enter an email');
                    return;
                }
                
                const memberData = {
                    name: name.trim(),
                    email: email.trim(),
                    location: location || null,
                    role: role,
                    dailyCapacity: parseFloat(capacity),
                    active: true,
                    leaveDays: currentMemberId ? leaveDays : [] // Empty array for new members
                };
                
                try {
                    let response;
                    if (currentMemberId) {
                        // Update existing member
                        response = await fetch(`${API_BASE_URL}/${currentMemberId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(memberData)
                        });
                    } else {
                        // Create new member
                        response = await fetch(API_BASE_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(memberData)
                        });
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess(data.message || `Team member ${currentMemberId ? 'updated' : 'added'} successfully`);
                closeModal();
                        await loadCurrentSprintAndMembers();
                    } else {
                        showError(data.message || 'Failed to save team member');
                    }
                } catch (error) {
                    console.error('Error saving member:', error);
                    showError('Error saving team member');
                }
            }
            
            // Utility functions
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // Toast notification system
            function showToast(message, type = 'success') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                // Define toast styles based on type
                const styles = {
                    success: {
                        bg: 'bg-green-500',
                        icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                              </svg>`,
                        iconBg: 'bg-green-600'
                    },
                    error: {
                        bg: 'bg-red-500',
                        icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                              </svg>`,
                        iconBg: 'bg-red-600'
                    },
                    warning: {
                        bg: 'bg-yellow-500',
                        icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                              </svg>`,
                        iconBg: 'bg-yellow-600'
                    }
                };
                
                const style = styles[type] || styles.success;
                
                // Create toast element
                const toast = document.createElement('div');
                toast.id = toastId;
                toast.className = `${style.bg} text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 min-w-[300px] max-w-md pointer-events-auto transform transition-all duration-300 ease-in-out translate-x-full opacity-0`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3 flex-1">
                        <div class="${style.iconBg} rounded-full p-1 flex-shrink-0">
                            ${style.icon}
                        </div>
                        <p class="text-sm font-medium">${escapeHtml(message)}</p>
                    </div>
                    <button onclick="removeToast('${toastId}')" class="text-white hover:text-gray-200 transition-colors flex-shrink-0">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Trigger animation after a small delay to ensure CSS transition works
                setTimeout(() => {
                    toast.classList.remove('translate-x-full', 'opacity-0');
                }, 10);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    removeToast(toastId);
                }, 5000);
            }
            
            function removeToast(toastId) {
                const toast = document.getElementById(toastId);
                if (toast) {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }
            }
            
            function showSuccess(message) {
                showToast(message, 'success');
            }
            
            function showError(message) {
                showToast(message, 'error');
            }
            
            function showWarning(message) {
                showToast(message, 'warning');
            }
            
            // Assign to Sprint Modal Functions
            async function openAssignToSprintModal() {
                // Check if we have a current sprint
                if (!currentSprintId) {
                    showError('No active sprint found. Please select a sprint first.');
                    return;
                }
                
                selectedMemberIds = [];
                
                // Render member list
                renderMemberSelectionList();
                
                // Show modal
                document.getElementById('assignSprintModal').classList.remove('hidden');
            }
            
            function closeAssignSprintModal() {
                selectedMemberIds = [];
                document.getElementById('assignSprintModal').classList.add('hidden');
            }
            
            function renderMemberSelectionList() {
                const container = document.getElementById('memberSelectionList');
                
                if (teamMembers.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-sm">No team members available</p>';
                    return;
                }
                
                // Pre-select members already assigned to the current sprint
                selectedMemberIds = teamMembers
                    .filter(member => member.assignedToCurrentSprint)
                    .map(member => member.id);
                
                container.innerHTML = teamMembers.map(member => {
                    const roleColors = {
                        'FRONTEND': 'bg-blue-100 text-blue-800',
                        'BACKEND': 'bg-green-100 text-green-800',
                        'QA': 'bg-yellow-100 text-yellow-800',
                        'DEVOPS': 'bg-purple-100 text-purple-800',
                        'DESIGNER': 'bg-pink-100 text-pink-800',
                        'MANAGER': 'bg-gray-100 text-gray-800'
                    };
                    const roleColor = roleColors[member.role] || 'bg-gray-100 text-gray-800';
                    
                    // Check if member is already assigned to current sprint
                    const isAssigned = member.assignedToCurrentSprint;
                    const checkedAttr = isAssigned ? 'checked' : '';
                    
                    return `
                        <label class="flex items-center p-3 hover:bg-white rounded-lg cursor-pointer transition-colors group">
                            <input type="checkbox" 
                                   value="${member.id}" 
                                   ${checkedAttr}
                                   onchange="toggleMemberSelection('${member.id}')"
                                   class="w-4 h-4 text-indigo-600 bg-gray-100 border-gray-300 rounded focus:ring-indigo-500 focus:ring-2">
                            <div class="ml-3 flex-1">
                                <div class="flex items-center justify-between">
                                    <span class="font-medium text-gray-900">${escapeHtml(member.name)}</span>
                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${roleColor}">
                                        ${member.role}
                                    </span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">${escapeHtml(member.email || 'No email')}</p>
                            </div>
                        </label>
                    `;
                }).join('');
                
                updateSelectedCount();
            }
            
            function toggleMemberSelection(memberId) {
                const index = selectedMemberIds.indexOf(memberId);
                if (index > -1) {
                    selectedMemberIds.splice(index, 1);
                } else {
                    selectedMemberIds.push(memberId);
                }
                updateSelectedCount();
            }
            
            function selectAllMembers() {
                selectedMemberIds = teamMembers.map(m => m.id);
                const checkboxes = document.querySelectorAll('#memberSelectionList input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = true);
                updateSelectedCount();
            }
            
            function deselectAllMembers() {
                selectedMemberIds = [];
                const checkboxes = document.querySelectorAll('#memberSelectionList input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);
                updateSelectedCount();
            }
            
            function updateSelectedCount() {
                document.getElementById('selectedCount').textContent = selectedMemberIds.length;
            }
            
            async function assignMembersToSprint() {
                if (!currentSprintId) {
                    showError('No active sprint found');
                    return;
                }
                
                if (selectedMemberIds.length === 0) {
                    showError('Please select at least one team member');
                    return;
                }
                
                try {
                    const response = await fetch('/api/team-members/assign-to-sprint', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            sprintId: currentSprintId,
                            memberIds: selectedMemberIds
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess(`Successfully assigned ${selectedMemberIds.length} member(s) to sprint`);
                        closeAssignSprintModal();
                        // Reload the team list to show updated sprint assignments
                        await loadCurrentSprintAndMembers();
                    } else {
                        showError(data.message || 'Failed to assign members to sprint');
                    }
                } catch (error) {
                    console.error('Error assigning members to sprint:', error);
                    showError('Failed to assign members to sprint');
                }
            }
            
            // Unassign confirmation modal functions
            let memberToUnassign = null;
            
            function openUnassignConfirm(memberId, memberName) {
                if (!currentSprintId) {
                    showError('No active sprint found');
                    return;
                }
                
                memberToUnassign = { id: memberId, name: memberName };
                document.getElementById('unassignMemberName').textContent = memberName;
                document.getElementById('unassignConfirmModal').classList.remove('hidden');
            }
            
            function closeUnassignConfirm() {
                memberToUnassign = null;
                document.getElementById('unassignConfirmModal').classList.add('hidden');
            }
            
            async function confirmUnassign() {
                if (!memberToUnassign) return;
                
                const { id, name } = memberToUnassign;
                closeUnassignConfirm();
                
                try {
                    const response = await fetch(`/api/team-members/${id}/sprint/${currentSprintId}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess(`Successfully unassigned ${name} from sprint`);
                        await loadCurrentSprintAndMembers();
                    } else {
                        showError(data.message || 'Failed to unassign member from sprint');
                    }
                } catch (error) {
                    console.error('Error unassigning member from sprint:', error);
                    showError('Failed to unassign member from sprint');
                }
            }
            
            // Assign confirmation modal functions
            let memberToAssign = null;
            
            function openAssignConfirm(memberId, memberName) {
                if (!currentSprintId) {
                    showError('No active sprint found');
                    return;
                }
                
                memberToAssign = { id: memberId, name: memberName };
                document.getElementById('assignMemberName').textContent = memberName;
                document.getElementById('assignConfirmModal').classList.remove('hidden');
            }
            
            function closeAssignConfirm() {
                memberToAssign = null;
                document.getElementById('assignConfirmModal').classList.add('hidden');
            }
            
            async function confirmAssign() {
                if (!memberToAssign) return;
                
                const { id, name } = memberToAssign;
                closeAssignConfirm();
                
                try {
                    const response = await fetch(`/api/team-members/${id}/sprint/${currentSprintId}`, {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess(`Successfully assigned ${name} to sprint`);
                        await loadCurrentSprintAndMembers();
                    } else {
                        showError(data.message || 'Failed to assign member to sprint');
                    }
                } catch (error) {
                    console.error('Error assigning member to sprint:', error);
                    showError('Failed to assign member to sprint');
                }
            }
        </script>
    </main>
</body>
</html>